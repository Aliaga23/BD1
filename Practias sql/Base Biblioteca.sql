CREATE DATABASE BIBLIOTECAUNIVERSIDAD;
USE BIBLIOTECAUNIVERSIDAD;

CREATE table AREA
( 
	ID INT NOT NULL primary KEY,
    DESCRIPCION VARCHAR(20) NOT NULL
);

CREATE table LIBRO
(
	CODIGO VARCHAR(3) NOT NULL PRIMARY KEY,
    TITULO VARCHAR(50) NOT NULL,
	AÃ‘O SMALLINT NOT NULL,
	IDAREA INT NOT NULL,
    FOREIGN KEY (IDAREA) REFERENCES AREA(ID)
    ON update CASCADE
    ON DELETE CASCADE
);

CREATE table LECTOR
( 
	CI INT NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(60) NOT NULL,
    SEXO CHAR NOT NULL,
    TELEFONO INT NOT NULL
);

CREATE table PRESTAMO
(
	NRO INT NOT NULL PRIMARY KEY,
    FECHA DATE NOT NULL,
    DIAS smallint NOT NULL,
    MONTO smallint not null,
    CILECTOR INT NOT NULL,
    FOREIGN KEY (CILECTOR) REFERENCES LECTOR(CI) 
    ON UPDATE CASCADE
    ON DELETE CASCADE
);

CREATE table DETALLEPRESTAMO
(
	NROPRESTAMO INT NOT NULL,
    CODIGOLIBRO VARCHAR(3) NOT NULL ,
    primary key(NROPRESTAMO, CODIGOLIBRO),
    foreign key(NROPRESTAMO) references PRESTAMO(NRO)
    ON UPDATE CASCADE
    ON DELETE CASCADE,
    foreign key(CODIGOLIBRO) references LIBRO(CODIGO)
    ON UPDATE CASCADE
    ON DELETE CASCADE
);

/*INSERTAR VALORES*/
insert INTO AREA VALUES(1, 'Matematicas');
insert INTO AREA VALUES(2, 'Computacion');
insert INTO AREA VALUES(3, 'Fisica');


insert INTO LIBRO VALUES('L01', 'Matematica aplicada', 2010, 1);
insert INTO LIBRO VALUES('L02', 'Algoritmos y programas', 2010, 2);
insert INTO LIBRO VALUES('L03', 'Excel avanzado', 2007, 2);
insert INTO LIBRO VALUES('L04', 'Introduccion a la fisica', 2010, 3);
insert INTO LIBRO VALUES('L05', 'Matematica I', 2009, 1);


insert INTO LECTOR VALUES(101, 'Joaquin Chumacero Yupanqui', 'm', 79850173);
insert INTO LECTOR VALUES(102, 'Patricia Aguilera Candia', 'f', 79850134);
insert INTO LECTOR VALUES(103, 'Saturnino Mamani Rodriguez', 'm', 79869456);	


insert INTO PRESTAMO VALUES(1, '2011/05/15', 2, 10, 103);
insert INTO PRESTAMO VALUES(2, '2011/05/17', 2, 20, 101);
insert INTO PRESTAMO VALUES(3, '2011/05/17', 1, 15, 102);
insert INTO PRESTAMO VALUES(4, '2011/05/19', 2, 20, 103);


insert INTO DETALLEPRESTAMO VALUES(1, 'L01');
insert INTO DETALLEPRESTAMO VALUES(2, 'L02');
insert INTO DETALLEPRESTAMO VALUES(2, 'L03');
insert INTO DETALLEPRESTAMO VALUES(3, 'L01');
insert INTO DETALLEPRESTAMO VALUES(3, 'L03');
insert INTO DETALLEPRESTAMO VALUES(4, 'L03');

/* ------------- CONSULTAS -------------------------------------------*/
SELECT  TITULO
FROM LIBRO
WHERE IDAREA = (SELECT ID FROM AREA WHERE DESCRIPCION = 'Matematicas')
  AND CODIGO NOT IN (
    SELECT CODIGOLIBRO
    FROM DETALLEPRESTAMO
);
SELECT  TITULO
FROM LIBRO, AREA 
WHERE LIBRO.IDAREA = AREA.ID
  AND AREA.DESCRIPCION = 'Matematicas'
  AND LIBRO.CODIGO NOT IN (
    SELECT CODIGOLIBRO
    FROM DETALLEPRESTAMO
);